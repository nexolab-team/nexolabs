<!--
┌── Message from havoc ────────────────────────────────────────────────────┐
│                                                                                │
│   Hello, me and my team have spent countless hours in designing this website   │
│   Please don't copy it, make something original from scratch                   │
│   It is not that hard really!!                                                 │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
-->
---
// Global Lightbox Component for all images
---

<div id="globalLightbox" class="lightbox-overlay" role="dialog" aria-modal="true" aria-label="Image viewer">
  <div class="lightbox-container">
    <button class="lightbox-close" aria-label="Close lightbox" title="Close (Esc)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <div class="lightbox-content">
      <img class="lightbox-image" src="" alt="" />
      <div class="lightbox-caption"></div>
    </div>
  </div>
</div>

<style is:global>
  /* Global Lightbox Overlay */
  .lightbox-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.97);
    z-index: 999999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  .lightbox-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }
  
  .lightbox-container {
    position: relative;
    max-width: 95vw;
    max-height: 95vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    transform: scale(0.85);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .lightbox-overlay.active .lightbox-container {
    transform: scale(1);
    opacity: 1;
  }
  
  .lightbox-content {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 100%;
    max-height: 90vh;
  }
  
  .lightbox-image {
    max-width: 100%;
    max-height: 85vh;
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 12px;
    border: 3px solid #00ffff;
    box-shadow: 
      0 0 50px rgba(0, 255, 255, 0.8),
      0 0 100px rgba(255, 0, 255, 0.5),
      0 25px 80px rgba(0, 0, 0, 0.9);
    transition: transform 0.3s ease;
  }
  
  .lightbox-image:hover {
    transform: scale(1.02);
  }
  
  .lightbox-caption {
    margin-top: 20px;
    padding: 12px 24px;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 8px;
    color: #00ffff;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    text-align: center;
    max-width: 90%;
    backdrop-filter: blur(10px);
  }
  
  .lightbox-caption:empty {
    display: none;
  }
  
  .lightbox-close {
    position: absolute;
    top: -70px;
    right: 0;
    width: 56px;
    height: 56px;
    background: rgba(255, 0, 255, 0.1);
    border: 2px solid #ff00ff;
    border-radius: 50%;
    color: #ff00ff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 10;
  }
  
  .lightbox-close svg {
    width: 28px;
    height: 28px;
    stroke-width: 3;
  }
  
  .lightbox-close:hover {
    background: #ff00ff;
    color: #000;
    transform: rotate(90deg) scale(1.15);
    box-shadow: 0 0 30px rgba(255, 0, 255, 1);
  }
  
  .lightbox-close:active {
    transform: rotate(90deg) scale(0.95);
  }
  
  /* Make all cert and writeup images clickable */
  .cert-card-img,
  .cert-image,
  img[src*="/images/writeups/"],
  img[src*="/assets/certs/"],
  img[src*="/assets/avatars/"] {
    cursor: zoom-in;
    transition: transform 0.2s ease, filter 0.2s ease;
  }
  
  .cert-card-img:hover img,
  .cert-image:hover,
  img[src*="/images/writeups/"]:hover,
  img[src*="/assets/certs/"]:hover {
    transform: scale(1.02);
    filter: brightness(1.1);
  }
  
  /* Prevent body scroll when lightbox is open */
  body.lightbox-open {
    overflow: hidden;
  }
  
  /* Loading spinner */
  .lightbox-image.loading {
    min-width: 100px;
    min-height: 100px;
    background: 
      linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent)
      0 0 / 50% 100% no-repeat;
    animation: loading 1.5s infinite;
  }
  
  @keyframes loading {
    0% { background-position: -100% 0; }
    100% { background-position: 200% 0; }
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .lightbox-close {
      top: -60px;
      width: 48px;
      height: 48px;
    }
    
    .lightbox-close svg {
      width: 24px;
      height: 24px;
    }
    
    .lightbox-caption {
      font-size: 12px;
      padding: 10px 16px;
    }
  }
</style>

<script is:inline>
(function() {
  'use strict';
  
  function initGlobalLightbox() {
    const lightbox = document.getElementById('globalLightbox');
    if (!lightbox) return;
    
    const lightboxImg = lightbox.querySelector('.lightbox-image');
    const lightboxCaption = lightbox.querySelector('.lightbox-caption');
    const closeBtn = lightbox.querySelector('.lightbox-close');
    
    let currentImg = null;
    
    // Open lightbox
    function openLightbox(imgElement) {
      const src = imgElement.src || imgElement.getAttribute('data-cert');
      if (!src) return;
      
      const alt = imgElement.alt || '';
      const caption = imgElement.getAttribute('data-caption') || alt;
      
      // Set image with loading state
      lightboxImg.classList.add('loading');
      lightboxImg.src = '';
      lightboxImg.alt = alt;
      lightboxCaption.textContent = caption;
      
      // Load image
      const tempImg = new Image();
      tempImg.onload = function() {
        lightboxImg.src = src;
        lightboxImg.classList.remove('loading');
      };
      tempImg.onerror = function() {
        lightboxImg.classList.remove('loading');
        lightboxCaption.textContent = 'Error loading image';
      };
      tempImg.src = src;
      
      currentImg = imgElement;
      lightbox.classList.add('active');
      document.body.classList.add('lightbox-open');
    }
    
    // Close lightbox
    function closeLightbox() {
      lightbox.classList.remove('active');
      document.body.classList.remove('lightbox-open');
      
      // Clear after animation
      setTimeout(() => {
        if (!lightbox.classList.contains('active')) {
          lightboxImg.src = '';
          lightboxCaption.textContent = '';
          currentImg = null;
        }
      }, 300);
    }
    
    // Find all clickable images
    function attachLightboxToImages() {
      // Selectors for images that should open in lightbox
      const selectors = [
        '.cert-card-img',
        '.cert-image',
        'img[src*="/images/writeups/"]',
        'img[src*="/assets/certs/"]',
        'img[src*="/assets/avatars/"]',
        '[data-lightbox]' // Custom attribute for any element
      ];
      
      selectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(element => {
          // Avoid duplicate listeners
          if (element.dataset.lightboxInit) return;
          element.dataset.lightboxInit = 'true';
          
          element.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // For elements with nested img
            const img = this.querySelector('img') || this;
            openLightbox(img);
          });
          
          // Add accessibility
          element.setAttribute('role', 'button');
          element.setAttribute('tabindex', '0');
          element.setAttribute('aria-label', 'Open image in lightbox');
          
          // Keyboard support
          element.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              const img = this.querySelector('img') || this;
              openLightbox(img);
            }
          });
        });
      });
    }
    
    // Close button
    closeBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      closeLightbox();
    });
    
    // Click outside to close
    lightbox.addEventListener('click', function(e) {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });
    
    // ESC key to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && lightbox.classList.contains('active')) {
        closeLightbox();
      }
    });
    
    // Initial attachment
    attachLightboxToImages();
    
    // Re-attach on dynamic content (for SPAs)
    const observer = new MutationObserver(() => {
      attachLightboxToImages();
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
    
    // Expose global function for manual triggering
    window.openLightbox = openLightbox;
    window.closeLightbox = closeLightbox;
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGlobalLightbox);
  } else {
    initGlobalLightbox();
  }
})();
</script>
